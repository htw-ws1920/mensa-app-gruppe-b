<html>
    <body>
        
        <button onclick="showData()">Let's Go</button>
        <br>
        <button onclick = "getDate()">heute</button>
        <button onclick="increaseDate()">nächter Tag</button>
        <button onclick="decreaseDate()">vorheriger Tag</button>
        <button onclick="nextWeek()">nächste Woche</button>
        <p id = "date"></p>
        <div id="meals"></div>

        <script>
            var currentDate = new Date();            

            function nextWeek() {

                currentDate.setDate(currentDate.getDate()+7)
                document.getElementById("date").innerHTML = currentDate;
                var year =currentDate.getFullYear();
                var month = currentDate.getMonth() +1;
                var day = currentDate.getDate();
                getMeals(year,month,day).then(response =>
                {
                    document.getElementById("meals").innerHTML = JSON.stringify(response);
                })
                
            }

            function increaseDate() {
                currentDate.setDate(currentDate.getDate()+1)
                document.getElementById("date").innerHTML = currentDate;
                var year =currentDate.getFullYear();
                var month = currentDate.getMonth() +1;
                var day = currentDate.getDate();
                getMeals(year,month,day).then(response =>
                {
                    document.getElementById("meals").innerHTML = JSON.stringify(response);
                })
            }

            function getDate() {
               
                currentDate = new Date();
                document.getElementById("date").innerHTML = currentDate;
                var year =currentDate.getFullYear();
                var month = currentDate.getMonth() +1;
                var day = currentDate.getDate();
                getMeals(year,month,day).then(response =>
                {
                    document.getElementById("meals").innerHTML = JSON.stringify(response);
                })

            }

            function decreaseDate() {
                currentDate.setDate(currentDate.getDate()-1)
                document.getElementById("date").innerHTML = currentDate;
                var year =currentDate.getFullYear();
                var month = currentDate.getMonth() +1;
                var day = currentDate.getDate();
                getMeals(year,month,day).then(response =>
                {
                    document.getElementById("meals").innerHTML = JSON.stringify(response);
                })
            }

            function showData() {
                GetData().then(response =>
                {
                    response = response.filter(entry =>
                    {
                        return entry.city === "Berlin";
                    })
                    console.log(response);
                })
            }
            
            function GetData() {

                return fetch('https://openmensa.org/api/v2/canteens/',
                {
                method: 'get',
                headers: {
                    "Content-Type": "application/json; charset=utf-8"
                },
                mode: "cors"
                })
                    .then( response =>
                    {
                        if ( response.status !== 200 )
                        {
                            console.log( 'Looks like there was a problem. Status Code: ' +
                                response.status );
                            return;
                        }
                        return response.json();
                    }
                    )                
                    .catch( err =>
                    {
                        console.log( 'Fetch Error :-S', err );
                    } );
    }
            function getMeals(year,month,day) {
                
                var adress = 'https://openmensa.org/api/v2/canteens/30/days/' +year+'-'+month+'-'+day+'/meals';

                console.log(adress);
                return fetch(adress,
                {
                method: 'get',
                headers: {
                    "Content-Type": "application/json; charset=utf-8"
                },
                mode: "cors"
                })
                    .then( response =>
                    {
                        if ( response.status !== 200 )
                        {
                            console.log( 'Looks like there was a problem. Status Code: ' +
                                response.status );
                            return;
                        }
                        return response.json();
                    }
                    )                
                    .catch( err =>
                    {
                        console.log( 'Fetch Error :-S', err );
                    } );
            }
        </script>
    </body>
</html>